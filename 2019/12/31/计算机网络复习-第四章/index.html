<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://rivers-shall.github.io').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>
<script data-ad-client="ca-pub-6100092033271048" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <meta name="description" content="《Computer Networking - A Top-Down Approach》第四章4.1-4.3复习知识点总结">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络复习-第四章">
<meta property="og:url" content="https://rivers-shall.github.io/2019/12/31/计算机网络复习-第四章/index.html">
<meta property="og:site_name" content="碧漾的自我">
<meta property="og:description" content="《Computer Networking - A Top-Down Approach》第四章4.1-4.3复习知识点总结">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-05-28T06:56:19.816Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="计算机网络复习-第四章">
<meta name="twitter:description" content="《Computer Networking - A Top-Down Approach》第四章4.1-4.3复习知识点总结">

<link rel="canonical" href="https://rivers-shall.github.io/2019/12/31/计算机网络复习-第四章/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>计算机网络复习-第四章 | 碧漾的自我</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129500136-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-129500136-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">碧漾的自我</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">beyond myself</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-fw fa-calendar"></i>日程表</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rivers-shall.github.io/2019/12/31/计算机网络复习-第四章/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/龙卷1.jpeg">
      <meta itemprop="name" content="碧漾">
      <meta itemprop="description" content="心中的自我永远也不能实现，所以才要鞭策现实的自我啊">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="碧漾的自我">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          计算机网络复习-第四章
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-31 10:11:35" itemprop="dateCreated datePublished" datetime="2019-12-31T10:11:35+08:00">2019-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 14:56:19" itemprop="dateModified" datetime="2020-05-28T14:56:19+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/NJU-Class/" itemprop="url" rel="index">
                    <span itemprop="name">NJU-Class</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/NJU-Class/计算机网络/" itemprop="url" rel="index">
                    <span itemprop="name">计算机网络</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>《Computer Networking - A Top-Down Approach》第四章4.1-4.3复习知识点总结</p>
<a id="more"></a>
<p>第四章主要是讲网络层，也就是IP协议。</p>
<h2 id="4-1-网络层概览"><a href="#4-1-网络层概览" class="headerlink" title="4.1 网络层概览"></a>4.1 网络层概览</h2><h3 id="4-1-1-转发和路由"><a href="#4-1-1-转发和路由" class="headerlink" title="4.1.1 转发和路由"></a>4.1.1 转发和路由</h3><p>转发和路由很相近，但是是两个不同的服务，都由网络层进行支持。</p>
<ul>
<li>转发。转发是指，一个IP包到达路由器，路由器决定要将这个包从哪一个接口再度发出去，以便该接口到达目的IP地址。这是一个路由器本地的操作。</li>
<li>路由。路由是指，在整个网络范围内，决定好从一个源地址到目的地址的路线。这是一个全网的操作，通常耗时更长。</li>
</ul>
<p>对于路由器来说，<strong>转发表</strong>是最重要的数据结构。</p>
<p>转发就是靠从IP包中找出几个域，而后从转发表中索引出目的IP地址对应的发出接口。</p>
<p>路由则是用来决定转发表中的值的。</p>
<h3 id="4-1-2-网络层服务模型"><a href="#4-1-2-网络层服务模型" class="headerlink" title="4.1.2 网络层服务模型"></a>4.1.2 网络层服务模型</h3><p>网络层服务模型为：最大努力模型，也就是没有任何保证的模型。</p>
<h2 id="4-2-路由器里有什么"><a href="#4-2-路由器里有什么" class="headerlink" title="4.2 路由器里有什么"></a>4.2 路由器里有什么</h2><p>路由器里有四个重要的组成部分：</p>
<ol>
<li>输入端口。输入端口有如下作用：<ol>
<li>终止物理连接，使得物理链路上传输的bit流进入路由器</li>
<li>进行链路层包解析，提取出网络层包</li>
<li>根据网络层的包结构进行转发，如果是控制消息包，比如路由协议的包，就转发给路由处理器，如果是数据包，就查询转发表并发到对应的输出端口上</li>
</ol>
</li>
<li>输出端口，向外传输数据</li>
<li>Switching Fabric 连接输入端口和输出端口/路由处理器</li>
<li>路由处理器，使用相应的路由协议，路由算法，维护转发表，接受路由协议消息或向外发送路由协议消息。</li>
</ol>
<p>其中，前三个部分一般以硬件实现(因为软件处理速度跟不上链路上包到达的速度，纳秒级的到达速度)，路由处理器一般由软件实现，对处理速度要求不高，因为路由协议的处理一般是毫秒或秒级的。</p>
<p>由于需要转发，转发之前就一定要根据到达的IP包中的信息进行处理，决定输出端口，而一般情况下有这两种决定方式：</p>
<ol>
<li>基于目的地的转发。通过检查IP包的目的IP地址，决定对应的输出端口。</li>
<li>一般化转发。一般化转发的思想是检查IP包的任意的信息，而后决定对应的输出端口。当然，对于每个IP包检查的信息是一致的，只不过不局限于目的IP地址而已。</li>
</ol>
<h3 id="4-2-1-输入端口处理和基于目的地的转发"><a href="#4-2-1-输入端口处理和基于目的地的转发" class="headerlink" title="4.2.1 输入端口处理和基于目的地的转发"></a>4.2.1 输入端口处理和基于目的地的转发</h3><p>输入端口有如下作用：</p>
<ol>
<li>终止物理连接，使得物理链路上传输的bit流进入路由器</li>
<li>进行链路层包解析，提取出网络层包</li>
<li>根据网络层的包结构进行转发，如果是控制消息包，比如路由协议的包，就转发给路由处理器，如果是数据包，就查询转发表并发到对应的输出端口上</li>
</ol>
<p>而对于基于目的地的转发，查询转发表的方式就是<strong>最长前缀匹配</strong>：</p>
<blockquote>
<p>对于一个目的IP地址A，转发表中有许多&lt;字符串,端口号&gt;对，将A与这些字符串进行匹配，匹配时仅仅使用A的前缀进行匹配，在所有匹配的字符串中，寻找最长的字符串，其对应的端口号就是输出端口号。</p>
</blockquote>
<h3 id="4-2-2-交换-Switching"><a href="#4-2-2-交换-Switching" class="headerlink" title="4.2.2 交换(Switching)"></a>4.2.2 交换(Switching)</h3><p>交换是指Switching Fabric将来自输入端口的IP包转交给输出端口的过程。</p>
<p>常见的交换方式有如下几种：</p>
<ul>
<li>基于主存的交换<ul>
<li>输入端口将到达的IP包写入主存，而后再从主存中读到输出端口上完成转发</li>
</ul>
</li>
<li>基于总线的交换<ul>
<li>输入端口给到达的IP包打上标签，发送到总线上，只有对应标签的输出端口会接受这个IP包</li>
</ul>
</li>
<li>基于交叉网络的交换<ul>
<li>多个端口对应多个总线的交叉网络</li>
</ul>
</li>
</ul>
<h3 id="4-2-3-输出端口处理"><a href="#4-2-3-输出端口处理" class="headerlink" title="4.2.3 输出端口处理"></a>4.2.3 输出端口处理</h3><p>输出端口需要取出从输入端口转发来的IP包，进行链路层封装后，转发出去。</p>
<h3 id="4-2-4-排队情境会在哪里出现"><a href="#4-2-4-排队情境会在哪里出现" class="headerlink" title="4.2.4 排队情境会在哪里出现"></a>4.2.4 排队情境会在哪里出现</h3><p>输入排队：如果Switching Fabric转发的速度比<strong>所有</strong>输入端口的IP包到达的速度要慢的话，就会在输入端口出现排队现象。</p>
<p>同时，排队时会出现行首阻塞(head of line blocking)的现象，也就是说对于一个输入端口上的队列，如果队首的包被阻塞，那么根据先进先出原则，即便后面的包所对应的输出端口没有被占用，也必须等待队首先被取出才行。这会极大降低转发效率。</p>
<hr>
<p>输出排队：如果Switching Fabric转发的速度比输出端口的处理速度还要快的话，就会在输出端口出现排队现象。</p>
<h3 id="4-2-5-Packet-Scheduling-包调度"><a href="#4-2-5-Packet-Scheduling-包调度" class="headerlink" title="4.2.5 Packet Scheduling 包调度"></a>4.2.5 Packet Scheduling 包调度</h3><p>包调度是指在一个输出端口的缓冲区上决定下面转发哪一个包。</p>
<hr>
<p>先进先出调度：简单，就是先到达的包先调度处理</p>
<hr>
<p>优先级调度排队：在包到达时，会先将包分类，不同的类有不同的优先级，也有自己的队列，取包时先从高优先级的队列中取。相同队列中的包一般以先进先出的方式处理。</p>
<p>优先级调度通常用在比如：</p>
<ul>
<li>网络控制包(比如路由协议包) 优先于 用户数据包</li>
<li>实时性数据包(比如实时视频会议数据) 优先于 普通数据(比如电子邮件)</li>
</ul>
<hr>
<p>轮询和权值轮询：在包到达时，先将包分类，不同的类有自己的队列，每次取包时，轮流从不同的队列中取。我们也可以为每个队列加上权值，权值高的每次多取几个包再转移到下一个队列中去取包。</p>
<h2 id="4-3-IP协议，IP地址，IPv4，IPv6"><a href="#4-3-IP协议，IP地址，IPv4，IPv6" class="headerlink" title="4.3 IP协议，IP地址，IPv4，IPv6"></a>4.3 IP协议，IP地址，IPv4，IPv6</h2><h3 id="4-3-1-IPv4包格式"><a href="#4-3-1-IPv4包格式" class="headerlink" title="4.3.1 IPv4包格式"></a>4.3.1 IPv4包格式</h3><p>IPv4包头有如下的域：</p>
<ul>
<li>版本号。IPv4或者IPv6</li>
<li>包头长度。由于IPv4包头有可选的域，于是需要说明一下包头长度</li>
<li>服务类型(Type of Service)。可以将比如实时性数据包和非实时性数据包区分开来。如何设置由路由器管理者决定。</li>
<li>包长度。</li>
<li>Identifier, flags, fragmentation offset.这三者用来处理IP包的分段</li>
<li>Time-to-live. 这个域用于确保IP包不会在网络中永久循环传播，每次经过一跳，就会减一，直到成为0，路由器就会直接丢弃该IP包。</li>
<li>上层协议。一般IP包到达目的地，才会通过这个域决定IP包中的数据交给哪个上层协议。类似于传输层的端口号决定传给哪个应用进程。</li>
<li>包头校验和。用于错误检查。注意，每一跳上，由于Time-to-live会改变，所以校验和也必须重新计算。</li>
<li>源IP地址，目的IP地址</li>
<li>可选项</li>
</ul>
<h3 id="4-3-2-IPv4包分段"><a href="#4-3-2-IPv4包分段" class="headerlink" title="4.3.2 IPv4包分段"></a>4.3.2 IPv4包分段</h3><p>由于链路层对于最大可传送的链路层包大小有限制，所以一个IP包未必能完整的组成一个整包进行发送，就需要用到IPv4包分段。</p>
<p>包分段主要涉及到包头Identifier, flags, fragmentation offset三个域：</p>
<ul>
<li>identifier 用于标示所在的原始包，也就是说，拥有相同identifier的片段是属于相同的原始IP包的</li>
<li>flags 包括两个flag<ul>
<li>一个用于标示是否允许IP协议进行分段</li>
<li>另一个用于标示该分段是否是最后一段，0表示最后一段，1表示不是最后一段</li>
</ul>
</li>
<li>fragmentation offset用于表示该分段的数据在原数据中的偏移，以八字节为单位<ul>
<li>比如fragmentation offset是20，就说明这个片段里的第一个字节的数据已经是原数据里第161字节的数据了，前面有160个字节的数据在别的分段里</li>
</ul>
</li>
</ul>
<h3 id="4-3-3-IPv4地址"><a href="#4-3-3-IPv4地址" class="headerlink" title="4.3.3 IPv4地址"></a>4.3.3 IPv4地址</h3><p>IPv4地址为32位的二进制数。</p>
<p>一般情况下，IPv4被表示为a.b.c.d的形式，其中，a,b,c,d是IPv4地址中第1,2,3,4个字节的十进制表示。</p>
<p>由于因特网被分成了各个不同的子网，所以对于每一个IPv4地址，都可以将它分为两部分，第一部分是网络地址部分，代表了该IP地址所在的网络，第二部分是主机地址部分，代表了IP地址在网络中的标识符。</p>
<p>现在的网络-主机地址划分方法为CIDR(Classless Interdomain Routing)，也就是以32位地址的前x位作为网络地址，剩下的32-x位是主机地址，记作a.b.c.d/x。</p>
<p>特殊的IP地址：255.255.255.255，该地址为特定的广播地址，只要向该地址发送IP包，路由器会自动将包发送到当前子网下的所有主机上，甚至有可能发送到子网外的主机上。</p>
<h4 id="获取子网IP地址"><a href="#获取子网IP地址" class="headerlink" title="获取子网IP地址"></a>获取子网IP地址</h4><p>想要获取子网的IP地址，必须向上一级的IP地址管理者发出申请并由上一级进行分配。</p>
<h4 id="获取主机IP地址"><a href="#获取主机IP地址" class="headerlink" title="获取主机IP地址"></a>获取主机IP地址</h4><p>主机的IP地址可以手动分配，也可以使用DHCP(Dynamic Host Configuration Protocol)进行分配。</p>
<h5 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h5><p>想要DHCP正常工作，子网内必须有一个DHCP服务器，当一个新到来的主机想要获得IP地址时，过程如下：</p>
<ol>
<li>主机尝试发现DHCP服务器。<ol>
<li>由于新来的主机既不清楚自己的IP地址，也不清楚DHCP服务器的IP地址，所以主机以0.0.0.0的源IP地址向广播端口255.255.255.255发送一条探测消息，固定端口号为67</li>
<li>在这条消息里会包含一个事务ID</li>
</ol>
</li>
<li>DHCP服务器给出IP地址。<ol>
<li>同样，由于DHCP服务器暂时无法确定主机的IP地址，它需要向255.255.255.255发送消息。</li>
<li>这条消息里包含了提供的IP地址，该地址的有效时间，自身DHCP服务器的IP地址，主机传来的事务ID。</li>
</ol>
</li>
<li>DHCP Request。<ol>
<li>新来的主机可能会从多个DHCP服务器中获得提供的IP地址，它需要选择一个，然后发送DHCP Request Message，此时还不确定能不能真的拿到该IP，所以仍然需要0.0.0.0到255.255.255.255发送Request</li>
<li>这个Request消息里会包含被选中的IP地址，那么对应的服务器就知道新来的主机选择了自己提供的IP</li>
</ol>
</li>
<li>DHCP ACK。<ol>
<li>DHCP服务器接收到新来主机的Request Message之后，发出DHCP ACK，确认已经配置好了。此时仍然需要向255.255.255.255发送ACK。</li>
</ol>
</li>
</ol>
<h3 id="4-3-4-Network-Address-Translation-NAT"><a href="#4-3-4-Network-Address-Translation-NAT" class="headerlink" title="4.3.4 Network Address Translation(NAT)"></a>4.3.4 Network Address Translation(NAT)</h3><p>在IP地址中，有一类地址被保留下来作为私有地址，10.0.0.0/8就是其中一类。</p>
<p>所谓私有地址就是指该地址只在当前所在的子网中有意义，一旦考虑外部网络，该地址就没有意义。</p>
<p>那么当私有地址的主机尝试和外界通讯时，需要将私有地址转化为公开地址，这就是NAT的作用。</p>
<p>NAT通过如下几点来进行私有地址到公开地址的转化：</p>
<ol>
<li>NAT由一个路由器来进行操作</li>
<li>NAT路由器拥有一个公开的IP地址，假设为X</li>
<li>NAT路由器中维护了一张&lt;端口号, &lt;私有IP，端口号&gt;&gt;的表，也就是说子网中的&lt;私有IP地址, 端口号&gt;对应到了&lt;统一的公开IP地址, 端口号&gt;上</li>
<li>当子网内的主机尝试向外发送包，源地址就从&lt;私有IP地址, 端口号&gt;被NAT转化为&lt;统一的公开IP地址, 端口号&gt;，同样，当外部网络发送包到NAT时，NAT将目的地址转化为&lt;私有IP地址, 端口号&gt;而后发给对应主机。</li>
</ol>
<p>NAT的使用备受争议：</p>
<ol>
<li>NAT打破了因特网中的分层原则，同时使用传输层和网络层来修改地址和端口号。</li>
<li>NAT将许多主机隐藏在了一个路由器后面，将原本用于定位应用进程的端口号用于定位主机，那么有一些专用的端口号比如服务器的80端口就会受到影响(事实上很少将服务器放置在NAT后面)</li>
</ol>
<h3 id="4-3-5-IPv6"><a href="#4-3-5-IPv6" class="headerlink" title="4.3.5 IPv6"></a>4.3.5 IPv6</h3><p>由于32位IPv4地址会被用尽，所以新的IPv6进入了开发阶段，虽然距离IPv4地址真正用尽还有一定的时间，但是想要部署IPv6，也同样需要大量的时间。</p>
<p>相比于IPv4，IPv6有如下特性：</p>
<ol>
<li>扩展的地址空间。<ol>
<li>IPv6地址为128位地址</li>
<li>IPv6地址除了支持IPv4中的单播，广播，还支持组播(即向固定的一组IP地址进行发包)</li>
</ol>
</li>
<li>定长的40字节包头<ol>
<li>除去了IPv4包头里的可选项</li>
<li>定长包头更加易于处理，路由更快</li>
</ol>
</li>
<li>流标签<ol>
<li>类似于IPv4中的Type of Service，IPv6使用流来区别不同的包</li>
<li>流标签用来区别不同的流</li>
</ol>
</li>
</ol>
<h4 id="IPv6-包头格式"><a href="#IPv6-包头格式" class="headerlink" title="IPv6 包头格式"></a>IPv6 包头格式</h4><p>IPv6包头中包含了：</p>
<ul>
<li>版本(IPv4 or IPv6)</li>
<li>等级(Traffic Class)，用于给包赋予优先级，可以是根据流来赋予，也可以根据源应用来赋予</li>
<li>流标签(Flow Label)，用于标示一个流</li>
<li>负载长度(Payload Length)，由于包头定长，所以只记录了携带数据的长度</li>
<li>下一包头(Next Header)，也就是类似于IPv4中的协议，用于标示上一层使用的协议(TCP,UDP, etc.)，或者指向可选项</li>
<li>跳限制(Hop Limit)，类似于IPv4中的Time-to-live，减小到零，直接丢弃</li>
<li>源地址和目的地址</li>
</ul>
<p>可以从IPv6的包头中看到，有一部分功能被删除了：</p>
<ul>
<li>分片/重组<ul>
<li>IPv6的IP包如果由于过大不能在链路层上传输，路由器会返回一个<em>Packet too big</em>的ICMP消息，而不是像IPv4一样进行分片</li>
<li>如果要分片，就是在收到ICMP消息后在终端主机上进行分片</li>
<li>加快了路由的速度</li>
</ul>
</li>
<li>校验和<ul>
<li>由于传输层和链路层都有校验机制，所以在网络层就不再设置校验机制</li>
<li>加快了路由速度</li>
</ul>
</li>
<li>可选项<ul>
<li>使用Next Header进行指向而不是放在包头内</li>
<li>定长的包头，更易处理</li>
</ul>
</li>
</ul>
<h4 id="IPv4到IPv6"><a href="#IPv4到IPv6" class="headerlink" title="IPv4到IPv6"></a>IPv4到IPv6</h4><p>如果想要从IPv4转变到IPv6，我们新建的IPv6路由器可以兼容IPv4的IP包路由，但是以往的IPv4路由器想要兼容IPv6就会比较困难。</p>
<p>我们可以使用隧道(tunneling)的方式解决这个问题。</p>
<p>也就是说，将两个IPv6的路由/主机之间的IPv4路由视作链路层协议而不是同等的网络层协议，当需要发送IPv6包时，将其包裹在一个IPv4包中发出，到达终点后解开IPv4包，提取出IPv6包。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/28/计算机网络复习-第三章/" rel="prev" title="计算机网络复习--第三章">
      <i class="fa fa-chevron-left"></i> 计算机网络复习--第三章
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/12/31/计算机网络复习-第五章/" rel="next" title="计算机网络复习-第五章">
      计算机网络复习-第五章 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-网络层概览"><span class="nav-number">1.</span> <span class="nav-text">4.1 网络层概览</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-转发和路由"><span class="nav-number">1.1.</span> <span class="nav-text">4.1.1 转发和路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-网络层服务模型"><span class="nav-number">1.2.</span> <span class="nav-text">4.1.2 网络层服务模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-路由器里有什么"><span class="nav-number">2.</span> <span class="nav-text">4.2 路由器里有什么</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-输入端口处理和基于目的地的转发"><span class="nav-number">2.1.</span> <span class="nav-text">4.2.1 输入端口处理和基于目的地的转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-交换-Switching"><span class="nav-number">2.2.</span> <span class="nav-text">4.2.2 交换(Switching)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-输出端口处理"><span class="nav-number">2.3.</span> <span class="nav-text">4.2.3 输出端口处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-排队情境会在哪里出现"><span class="nav-number">2.4.</span> <span class="nav-text">4.2.4 排队情境会在哪里出现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-5-Packet-Scheduling-包调度"><span class="nav-number">2.5.</span> <span class="nav-text">4.2.5 Packet Scheduling 包调度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-IP协议，IP地址，IPv4，IPv6"><span class="nav-number">3.</span> <span class="nav-text">4.3 IP协议，IP地址，IPv4，IPv6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-IPv4包格式"><span class="nav-number">3.1.</span> <span class="nav-text">4.3.1 IPv4包格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-IPv4包分段"><span class="nav-number">3.2.</span> <span class="nav-text">4.3.2 IPv4包分段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-IPv4地址"><span class="nav-number">3.3.</span> <span class="nav-text">4.3.3 IPv4地址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#获取子网IP地址"><span class="nav-number">3.3.1.</span> <span class="nav-text">获取子网IP地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取主机IP地址"><span class="nav-number">3.3.2.</span> <span class="nav-text">获取主机IP地址</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#DHCP"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">DHCP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-Network-Address-Translation-NAT"><span class="nav-number">3.4.</span> <span class="nav-text">4.3.4 Network Address Translation(NAT)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-5-IPv6"><span class="nav-number">3.5.</span> <span class="nav-text">4.3.5 IPv6</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IPv6-包头格式"><span class="nav-number">3.5.1.</span> <span class="nav-text">IPv6 包头格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IPv4到IPv6"><span class="nav-number">3.5.2.</span> <span class="nav-text">IPv4到IPv6</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="碧漾" src="/images/龙卷1.jpeg">
  <p class="site-author-name" itemprop="name">碧漾</p>
  <div class="site-description" itemprop="description">心中的自我永远也不能实现，所以才要鞭策现实的自我啊</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:riversshall@qq.com" title="E-Mail → mailto:riversshall@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → /atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">碧漾</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'e4755b6b14b374b3c19b',
      clientSecret: 'e84c0b701bf42f9e8a2d98009f3fe3044b611529',
      repo: 'blog-comment',
      owner: 'Rivers-Shall',
      admin: ['Rivers-Shall'],
      id: '6dbd52a90f93f4dd1358bc8d53f0b5e9',
        language: 'zh-CN',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
